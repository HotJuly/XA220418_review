#  跨域相关

1. 问题一:什么是跨域

   1. 违反了浏览器的同源策略

   2. 问题:什么是同源策略

      1. 两个URL中的协议名,域名,端口三者都相同就称为同源

      2. ```javascript
         //例子一:以下两个链接协议名不同,所以不同源
         	http://localhost:3000/about
         	ftp://localhost:3000/home

         //例子二:以下两个链接域名不相同,所以不同源
         	http://localhost:3000/about
         	http://127.0.0.1:3000/home

         //例子三:以下两个链接仅有查询字符串不同,而查询字符串不再判断范围之内,所以是同源的
         	http://localhost:3000/about?a=1
         	http://localhost:3000/home?b=2
         ```
         ​

      3. URL的组成部分:协议名+域名(主机地址)+端口号+查询字符串(查询字符串包括了路由接口和请求参数)

2. 问题二:跨域一定会报错吗?

   1. 不一定
   2. img/video/audio/link/script等标签跨域不会报错
   3. 服务器之间跨域不会报错
   4. **总结:跨域不一定就会报错,只有在某些特定情况下才会**

3. 问题三:什么情况下会出现跨域问题

   1. 在浏览器中会出现
   2. 发送ajax请求的时候可能会出现跨域报错
   3. **总结:也就是说跨域问题是浏览器搞的鬼**

4. 问题四:哪些请求算是ajax请求(ajax->async javascript and xml)

   1. 只有使用js发送的请求才会是ajax请求
   2. 因为img/video/audio/link/script等标签都没用到js,所以他们发送的只是HTTP请求,所以不会跨域报错
   3. **总结:ajax是一种发送http请求的技术,不是一种特殊的请求**

5. 跨域问题解决方案

   1. jsonp
      1. 原理:script标签跨域请求资源不会报错
      2. 流程:
         1. 前端网页中准备一个存储数据的变量和接收数据的函数
         2. 前端在用户操作的时候,生成一个script标签,并添加src属性为后端接口
            1. 其中将前端接收数据的函数名称,作为query参数传递给服务器
         3. 服务器根据传过来的函数名称,配合需要返回的数据,组成一个全新的字符串,并进行返回
         4. 前端接收到返回的字符串后,script会自动将该字符串作为js代码执行
      3. 好处:
         1. 该方案上线之后依旧可以正常使用
      4. 坏处:
         1. 后端需要准备专门的接口拼接数据,很麻烦
         2. 前端还要准备变量,函数,script标签才能发送成功
   2. CORS(跨域资源共享)
      1. 原理:跨域问题是浏览器搞的鬼,只要浏览器和服务器双方都允许本次请求,那么就不会跨域
      2. 流程:
         1. 后端在响应头头添加配置即可
            1. Access-Control-Allow-Origin: *
      3. 好处:
         1. 前端什么都不用做,请求就可以了
      4. 坏处:
         1. 后端需要给这些请求都进行额外操作,在响应头中进行配置
   3. proxy
      1. 原理:浏览器和服务器之间根本不存在跨域问题
      2. 好处
         1. 前端配置简单方便,不容易出问题
      3. 坏处:
         1. 项目上线之后,该方案就失效了
      4. 流程:
         1. 先写好相关配置,Vue-cli在vue.config.js中配置devSever
            1. 如果是vite,就在vite.config.js中配置server
         2. 在浏览器地址栏中输入http://localhost:8080,从而获取到当前项目的html文件
            1. 也就是说html文件原本存储在开发服务器
         3. 该html文件会向devServer发送ajax请求获取相关数据
            1. 此时在请求路径中,我们会添**加上统一的前缀/api**,目的是为了告知开发服务器当前请求是需要转发的
         4. devServer接收到当前请求之后,会根据配置中对应的内容,**自动转发请求到指定的target上**
         5. 在转发请求的过程中,**我们需要将前缀/api进行删除(也就是路径重写pathRewrite)**
            1. 如果不删除前缀,目标服务器虽然接收到了,但是可能服务器没有该接口,可能会请求404
         6. 对方服务器成功接收到请求,并返回对应的响应数据给devServer
         7. 最终devServer将请求得到的数据,通过响应返回给html网页
      5. 注意:
         1. **只有在devServer发送请求给对方数据服务器的时候,才会具有路径重写这个操作**
            1. **而我们的html发送请求给devServer是不需要路径重写的**



